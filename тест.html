<!DOCTYPE html>

<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>–¢–µ—Å—Ç—ã</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .container {
        max-width: 600px;
        width: 100%;
    }

    .header {
        background: white;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    h1 {
        color: #667eea;
        font-size: 24px;
        margin-bottom: 10px;
    }

    .progress {
        background: #e0e0e0;
        height: 8px;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 10px;
    }

    .progress-bar {
        background: linear-gradient(90deg, #667eea, #764ba2);
        height: 100%;
        width: 0%;
        transition: width 0.3s;
    }

    .upload-section {
        background: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .upload-btn {
        background: #667eea;
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 15px;
    }

    #fileInput {
        display: none;
    }

    .question-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        display: none;
    }

    .question-text {
        font-size: 18px;
        color: #333;
        margin-bottom: 20px;
        line-height: 1.5;
    }

    .answer-btn {
        width: 100%;
        padding: 15px;
        margin: 10px 0;
        border: 2px solid #e0e0e0;
        background: white;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
        text-align: left;
        transition: all 0.3s;
    }

    .answer-btn:active {
        transform: scale(0.98);
    }

    .answer-btn.correct {
        background: #4caf50;
        color: white;
        border-color: #4caf50;
    }

    .answer-btn.incorrect {
        background: #f44336;
        color: white;
        border-color: #f44336;
    }

    .answer-btn:disabled {
        cursor: not-allowed;
    }

    .next-btn {
        width: 100%;
        padding: 15px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 15px;
        display: none;
    }

    .results {
        background: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        display: none;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .score {
        font-size: 48px;
        color: #667eea;
        font-weight: bold;
        margin: 20px 0;
    }

    .restart-btn {
        background: #667eea;
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 20px;
    }

    .info-text {
        color: #666;
        margin-top: 15px;
        font-size: 14px;
        line-height: 1.6;
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h1>
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <p id="questionCounter" style="margin-top: 10px; color: #666;"></p>
        </div>

```
    <div class="upload-section" id="uploadSection">
        <h2>üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏</h2>
        <p class="info-text">
            –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: .txt, .docx<br><br>
            <strong>–§–æ—Ä–º–∞—Ç:</strong><br>
            –í–æ–ø—Ä–æ—Å (—Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞)<br>
            –ü–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç<br>
            –í—Ç–æ—Ä–æ–π –≤–∞—Ä–∏–∞–Ω—Ç<br>
            –¢—Ä–µ—Ç–∏–π –≤–∞—Ä–∏–∞–Ω—Ç<br>
            –ß–µ—Ç–≤–µ—Ä—Ç—ã–π –≤–∞—Ä–∏–∞–Ω—Ç<br>
            (–≤–∞—Ä–∏–∞–Ω—Ç—ã –±—É–¥—É—Ç –ø–µ—Ä–µ–º–µ—à–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
        </p>
        <input type="file" id="fileInput" accept=".txt,.docx">
        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
            –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
        </button>
        <p id="loadingText" style="color: #667eea; margin-top: 10px; display: none;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    </div>

    <div class="question-card" id="questionCard">
        <div class="question-text" id="questionText"></div>
        <div id="answersContainer"></div>
        <button class="next-btn" id="nextBtn">–°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å ‚Üí</button>
    </div>

    <div class="results" id="results">
        <h2>üéâ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!</h2>
        <div class="score" id="finalScore"></div>
        <p id="resultText"></p>
        <button class="restart-btn" onclick="location.reload()">–ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
<script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ mammoth
    if (typeof mammoth === 'undefined') {
        console.error('Mammoth library not loaded');
    }
</script>
<script>
    let questions = [];
    let currentQuestion = 0;
    let score = 0;
    let answered = false;

    document.getElementById('fileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        document.getElementById('loadingText').style.display = 'block';

        if (file.name.endsWith('.docx')) {
            const reader = new FileReader();
            reader.onload = function(event) {
                mammoth.extractRawText({arrayBuffer: event.target.result})
                    .then(result => {
                        parseQuestions(result.value);
                        document.getElementById('loadingText').style.display = 'none';
                    })
                    .catch(err => {
                        alert('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è .docx —Ñ–∞–π–ª–∞');
                        document.getElementById('loadingText').style.display = 'none';
                    });
            };
            reader.readAsArrayBuffer(file);
        } else {
            const reader = new FileReader();
            reader.onload = function(event) {
                parseQuestions(event.target.result);
                document.getElementById('loadingText').style.display = 'none';
            };
            reader.readAsText(file, 'UTF-8');
        }
    });

    function parseQuestions(text) {
        const lines = text.split('\n').map(l => l.trim()).filter(l => l && l.length > 1);
        let i = 0;
        
        while (i < lines.length) {
            const line = lines[i];
            
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
            if (line.includes('–ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–ê–Ø –ö–£–õ–¨–¢–£–†–ê') || 
                line === '–¢–µ—Å—Ç—ã' || 
                line.length < 5) {
                i++;
                continue;
            }
            
            // –ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ - –¥–ª–∏–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å —Ç–µ–∫—Å—Ç–æ–º –≤–æ–ø—Ä–æ—Å–∞
            if (line.length > 50 || line.includes('?') || 
                (i + 4 < lines.length && !lines[i].match(/^[–ê-–Ø]\./))) {
                
                const question = {
                    text: line,
                    answers: [],
                    correctIndex: 0 // –ü–µ—Ä–≤—ã–π –æ—Ç–≤–µ—Ç –≤—Å–µ–≥–¥–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
                };
                
                i++;
                let answerCount = 0;
                
                // –°–æ–±–∏—Ä–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ (–æ–±—ã—á–Ω–æ 4)
                while (i < lines.length && answerCount < 4) {
                    let answerLine = lines[i];
                    
                    // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å—ã —Ç–∏–ø–∞ "–ê.", "–î.", "–ö." –∏ —Ç.–¥.
                    answerLine = answerLine.replace(/^[–ê-–Ø]\./, '').trim();
                    
                    if (answerLine.length > 0 && answerLine.length < 150) {
                        question.answers.push(answerLine);
                        answerCount++;
                    }
                    i++;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–ø—Ä–æ—Å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É –Ω–µ–≥–æ –µ—Å—Ç—å –º–∏–Ω–∏–º—É–º 2 –æ—Ç–≤–µ—Ç–∞
                if (question.answers.length >= 2) {
                    questions.push(question);
                }
            } else {
                i++;
            }
        }
        
        if (questions.length > 0) {
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã
            shuffleArray(questions);
            
            document.getElementById('uploadSection').style.display = 'none';
            showQuestion();
        } else {
            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.');
        }
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function showQuestion() {
        answered = false;
        const q = questions[currentQuestion];
        
        // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –æ—Ç–≤–µ—Ç–æ–≤ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
        const answersWithIndex = q.answers.map((ans, idx) => ({
            text: ans,
            isCorrect: idx === q.correctIndex
        }));
        
        // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –æ—Ç–≤–µ—Ç—ã
        shuffleArray(answersWithIndex);
        
        document.getElementById('questionCard').style.display = 'block';
        document.getElementById('questionText').textContent = q.text;
        document.getElementById('questionCounter').textContent = 
            `–í–æ–ø—Ä–æ—Å ${currentQuestion + 1} –∏–∑ ${questions.length}`;
        
        const progress = ((currentQuestion) / questions.length) * 100;
        document.getElementById('progressBar').style.width = progress + '%';
        
        const container = document.getElementById('answersContainer');
        container.innerHTML = '';
        
        answersWithIndex.forEach((answer) => {
            const btn = document.createElement('button');
            btn.className = 'answer-btn';
            btn.textContent = answer.text;
            btn.onclick = () => checkAnswer(answer.isCorrect, btn, answersWithIndex);
            container.appendChild(btn);
        });
        
        document.getElementById('nextBtn').style.display = 'none';
    }

    function checkAnswer(isCorrect, clickedBtn, allAnswers) {
        if (answered) return;
        answered = true;
        
        const buttons = document.querySelectorAll('.answer-btn');
        
        buttons.forEach((btn, idx) => {
            btn.disabled = true;
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∑–µ–ª–µ–Ω—ã–º
            if (allAnswers[idx].isCorrect) {
                btn.classList.add('correct');
            }
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –∫—Ä–∞—Å–Ω—ã–º
            else if (btn === clickedBtn && !isCorrect) {
                btn.classList.add('incorrect');
            }
        });
        
        if (isCorrect) {
            score++;
        }
        
        document.getElementById('nextBtn').style.display = 'block';
    }

    document.getElementById('nextBtn').onclick = function() {
        currentQuestion++;
        if (currentQuestion < questions.length) {
            showQuestion();
        } else {
            showResults();
        }
    };

    function showResults() {
        document.getElementById('questionCard').style.display = 'none';
        document.getElementById('results').style.display = 'block';
        
        const percentage = Math.round((score / questions.length) * 100);
        document.getElementById('finalScore').textContent = `${score}/${questions.length}`;
        document.getElementById('resultText').textContent = 
            `–í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞ ${percentage}% –≤–æ–ø—Ä–æ—Å–æ–≤`;
        
        document.getElementById('progressBar').style.width = '100%';
    }
</script>
```

</body>
</html>
